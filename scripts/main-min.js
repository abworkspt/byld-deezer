var ABW;(ABW=ABW||{}).MAIN={init:function(){$("[data-control]").each(function(t,e){var i=$(e).data(),s=i.control;ABW[s]&&("function"==typeof ABW[s]?(new ABW[s]).init(e,i):"object"==typeof ABW[s]&&ABW[s].init(e,i))})}},history.scrollRestoration?history.scrollRestoration="manual":window.onbeforeunload=function(){window.scrollTo(0,0)},document.addEventListener("DOMContentLoaded",t=>{gsap.registerPlugin(ScrollTrigger,ScrollSmoother),ABW.MAIN.init()}),(ABW=ABW||{}).INSCPHASE1={init:function(t){this.$root=$(t),this.initVars(),this.initEvents()},initVars(){this.$form=this.$root.find("form.insc-form"),this.$submitcontainer=this.$root.find(".submit-container"),this.$upload=this.$root.find(".insc-upload"),this.$zone=this.$upload.find(".zone"),this.$input=this.$upload.find('input[type="file"][name="fotos[]"]'),this.$list=this.$upload.find(".file-list"),this.$list.length||(this.$list=$('<div class="file-list" />').appendTo(this.$upload)),this.$nome=this.$form.find('[name="nome"]'),this.$apelido=this.$form.find('[name="apelido"]'),this.$email=this.$form.find('[name="email"]'),this.$tel=this.$form.find('[name="telefone"]'),this.$nasc=this.$form.find('[name="nascimento"]'),this.$cidade=this.$form.find('[name="cidade"]'),this.$grupo=this.$form.find('[name="grupo"]'),this.$estilo=this.$form.find('[name="estilo"]'),this.$insta=this.$form.find('[name="instagram"]'),this.$deezer=this.$form.find('[name="deezer"]'),this.$consent=this.$form.find('[name="consent"]'),this.maxFiles=5,this.minFiles=1,this.maxSize=10485760,this.accept=["image/jpeg","image/png"],this.allowSend=!0,this.files=[],this.dtSupported=!1;try{this.dt=new DataTransfer,this.dtSupported=!!this.dt&&!!this.dt.items}catch(t){this.dtSupported=!1}},initEvents(){const t=this;$(".js-insc-open").on("click",this.openModal.bind(this)),$(".js-insc-close").on("click",this.closeModal.bind(this)),this.$zone.on("click",()=>this.$input.trigger("click")),this.$zone.on("dragenter dragover",t=>{t.preventDefault(),t.stopPropagation(),this.$zone.addClass("dragover")}).on("dragleave dragend",t=>{t.preventDefault(),t.stopPropagation(),this.$zone.removeClass("dragover")}).on("drop",t=>{t.preventDefault(),t.stopPropagation(),this.$zone.removeClass("dragover"),this.addFiles(t.originalEvent.dataTransfer.files),this.updatePhotoValidity()}),this.$input.on("change",t=>{this.addFiles(t.target.files),t.target.value="",this.updatePhotoValidity()}),this.$list.on("click",".remove",function(){const e=Number($(this).closest(".file").data("idx"));t.removeAt(e),t.updatePhotoValidity()}),this.$form.on("submit",e=>{if(e.preventDefault(),!t.allowSend)return;if(t.allowSend=!1,!this.validateAll())return void(t.allowSend=!0);t.$submitcontainer.addClass("sending");const i=new FormData(this.$form[0]);i.delete("fotos[]"),this.files.forEach(t=>i.append("fotos[]",t,t.name)),fetch(this.$form.attr("action"),{method:"POST",body:i,credentials:"same-origin"}).then(t=>t.json()).then(e=>{if(e&&e.success)t.$root.addClass("success");else{const t=e&&e.data&&e.data.message?e.data.message:"Erreur lors de l'envoi.";alert(t)}console.log("SUCCEEE"),t.allowSend=!0,console.log(t.allowSend)}).catch(()=>{t.allowSend=!0,alert("Erreur lors de l'envoi.")})});const e=(t,e)=>this.$form.on("blur change",t,()=>this.setFieldValidity(e()));e('[name="nome"]',()=>this.validateNome()),e('[name="apelido"]',()=>this.validateApelido()),e('[name="email"]',()=>this.validateEmail()),e('[name="telefone"]',()=>this.validateTel()),e('[name="nascimento"]',()=>this.validateNasc()),e('[name="cidade"]',()=>this.validateCidade()),e('[name="grupo"]',()=>this.validateGrupo()),e('[name="estilo"]',()=>this.validateEstilo()),e('[name="instagram"]',()=>this.validateInsta()),e('[name="deezer"]',()=>this.validateDeezer()),e('[name="consent"]',()=>this.validateConsent())},openModal(t){t.preventDefault(),$("body").addClass("modal-open"),$(".insc-overlay").addClass("open")},closeModal(){console.log("close",this.allowSend),this.allowSend&&($("body").removeClass("modal-open"),$(".insc-overlay").removeClass("open"))},addFiles(t){const e=Array.from(t);for(const t of e){if(this.files.length>=this.maxFiles){this.flash("Maximum "+this.maxFiles+" photos.");break}this.accept.includes(t.type)?t.size>this.maxSize?this.flash("Chaque fichier doit être inférieur à 10 Mo."):this.isDuplicate(t)?this.flash("Fichier déjà ajouté ignoré."):this.files.push(t):this.flash("Seulement JPG/PNG.")}this.syncInput(),this.renderList()},removeAt(t){t<0||t>=this.files.length||(this.files.splice(t,1),this.syncInput(),this.renderList())},isDuplicate(t){return this.files.some(e=>e.name===t.name&&e.size===t.size&&e.lastModified===t.lastModified)},syncInput(){this.dtSupported&&(this.dt=new DataTransfer,this.files.forEach(t=>this.dt.items.add(t)),this.$input[0].files=this.dt.files)},renderList(){this.$list.empty(),this.files.length?(this.$list.addClass("has-items"),this.files.forEach((t,e)=>{const i=URL.createObjectURL(t),s=$(`<div class="file" data-idx="${e}">\n              <div class="thumb"><img alt=""></div>\n              <div class="meta"><span class="name"></span><span class="size"></span></div>\n              <button type="button" class="remove" aria-label="Supprimer">×</button>\n            </div>`);s.find(".name").text(t.name),s.find(".size").text(this.humanSize(t.size)),s.find("img").attr("src",i).on("load",()=>URL.revokeObjectURL(i)),this.$list.append(s)})):this.$list.removeClass("has-items")},humanSize(t){if(t<1024)return t+" o";const e=t/1024;return e<1024?Math.round(e)+" Ko":(e/1024).toFixed(2)+" Mo"},flash(t){if(!t)return;const e=$('<div class="dz-msg" />').text(t).appendTo(this.$zone);this.$zone.addClass("shake"),setTimeout(()=>{e.fadeOut(150,()=>e.remove()),this.$zone.removeClass("shake")},1300)},validateAll(){const t=[this.validateNome(),this.validateApelido(),this.validateEmail(),this.validateTel(),this.validateNasc(),this.validateCidade(),this.validateGrupo(),this.validateEstilo(),this.validateInsta(),this.validateDeezer(),this.validateConsent(),this.validatePhotos()].find(t=>!t.valid);return!t||(this.setFieldValidity(t),t.$el.trigger("focus"),!1)},validateNome(){return this._required(this.$nome,"Indique ton nom.")},validateApelido(){return this._required(this.$apelido,"Indique ton prénom.")},validateEmail(){const t=(this.$email.val()||"").trim(),e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t);return{$el:this.$email,valid:e,msg:e?"":"Email invalide."}},validateTel(){const t=(this.$tel.val()||"").trim(),e=/^0[1-9](?:[ .-]?\d{2}){4}$/.test(t);return{$el:this.$tel,valid:e,msg:e?"":"Numéro de téléphone invalide."}},validateNasc(){const t=(this.$nasc.val()||"").trim();let e=!!t,i="Sélectionne ta date de naissance.";if(e){const s=new Date(t),a=this.calcAge(s);i=(e=!isNaN(s.getTime())&&a>=16&&a<=120)?"":"Âge minimum 16 ans."}return{$el:this.$nasc,valid:e,msg:i}},validateCidade(){return this._required(this.$cidade,"Indique ta ville.")},validateGrupo(){return this._required(this.$grupo,"Indique le nom de ton groupe.")},validateEstilo(){return this._required(this.$estilo,"Indique ton style musical.")},validateInsta(){const t=(this.$insta.val()||"").trim(),e=/^@?[\w\.]{1,30}$/.test(t);return{$el:this.$insta,valid:e,msg:e?"":"Handle Instagram invalide."}},validateDeezer(){const t=(this.$deezer.val()||"").trim();try{return new URL(t),{$el:this.$deezer,valid:!0,msg:""}}catch(t){return{$el:this.$deezer,valid:!1,msg:"Lien Deezer invalide."}}},validateConsent(){const t=this.$consent.is(":checked");return{$el:this.$consent,valid:t,msg:t?"":"Tu dois accepter le règlement."}},validatePhotos(){const t=this.files.length,e=t>=this.minFiles&&t<=this.maxFiles,i=t?t>this.maxFiles?"Maximum "+this.maxFiles+" photos.":"":"Ajoute au moins une photo.";return{$el:this.$zone,valid:e,msg:i}},updatePhotoValidity(){const t=this.validatePhotos();this.setFieldValidity(t)},_required(t,e){const i=(t.val()||"").trim();return{$el:t,valid:!!i,msg:i?"":e}},calcAge(t){const e=new Date;let i=e.getFullYear()-t.getFullYear();const s=e.getMonth()-t.getMonth();return(s<0||0===s&&e.getDate()<t.getDate())&&i--,i},setFieldValidity(t){const e=t.$el,i=e.closest("label, .consent, .zone");let s=i.find(".field-error");return s.length||(s=$('<span class="field-error" aria-live="polite"></span>').appendTo(i)),t.valid?(e.attr("aria-invalid","false"),i.removeClass("has-error"),s.text("")):(e.attr("aria-invalid","true"),i.addClass("has-error"),s.text(t.msg)),t.valid}},(ABW=ABW||{}).PHASE1={init:function(t){this.el=$(t),this.initCountdown()},initCountdown(){const t=this.el.find(".countdown"),e=t.data("date").replace(/(\d{2})\/(\d{2})\/(\d{4}) (.*)/,"$3-$2-$1T$4");function i(){const i=(new Date).getTime(),s=new Date(e).getTime()-i;if(s<=0)return void t.text("00j 00h 00m");const a=Math.floor(s/864e5),n=Math.floor(s/36e5%24),o=Math.floor(s/6e4%60);t.text(`${a}j ${n.toString().padStart(2,"0")}h ${o.toString().padStart(2,"0")}m`)}i(),setInterval(i,6e4)}};