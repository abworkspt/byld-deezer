var ABW;(ABW=ABW||{}).MAIN={init:function(){$("[data-control]").each(function(e,t){var i=$(t).data(),s=i.control;ABW[s]&&("function"==typeof ABW[s]?(new ABW[s]).init(t,i):"object"==typeof ABW[s]&&ABW[s].init(t,i))})}},history.scrollRestoration?history.scrollRestoration="manual":window.onbeforeunload=function(){window.scrollTo(0,0)},document.addEventListener("DOMContentLoaded",e=>{gsap.registerPlugin(ScrollTrigger,ScrollSmoother),ABW.MAIN.init()}),(ABW=ABW||{}).GLOBAL={init:function(e,t){this.el=$(e),this.initSmoothScroller(),this.checkCookie(),this.initEvents()},checkCookie(){this.getCookie("dezzerwebsite")?this.loadMatomo():$("#cookie-banner").removeClass("close")},initEvents(){$("#cookie-banner .js-ok").on("click",this.acceptCookie.bind(this)),$("#cookie-banner .js-notok").on("click",this.closeCookieBanner.bind(this))},acceptCookie(e){e.preventDefault(),this.setCookie("dezzerwebsite","1",365),this.loadMatomo(),this.closeCookieBanner(e)},closeCookieBanner(e){e.preventDefault(),this.setCookie("dezzerwebsite","1",365),$("#cookie-banner").addClass("close")},setCookie(e,t,i){const s=new Date;s.setTime(s.getTime()+24*i*60*60*1e3);const o="expires="+s.toUTCString();document.cookie=`${e}=${t};${o};path=/`},getCookie(e){const t=e+"=",i=decodeURIComponent(document.cookie).split(";");for(let e of i){for(;" "===e.charAt(0);)e=e.substring(1);if(0===e.indexOf(t))return e.substring(t.length,e.length)}return""},initSmoothScroller(){ABW.smoother=ScrollSmoother.create({smooth:1,effects:!0,smoothTouch:!0}),window.innerWidth<=768&&ABW.smoother.kill(),window.addEventListener("load",()=>ScrollTrigger.refresh())},loadMatomo(){var e=window._paq=window._paq||[];e.push(["trackPageView"]),e.push(["enableLinkTracking"]),e.push(["setTrackerUrl","https://rocon.matomo.cloud/matomo.php"]),e.push(["setSiteId","1"]);var t=document.createElement("script");t.async=!0,t.src="https://cdn.matomo.cloud/rocon.matomo.cloud/matomo.js",document.head.appendChild(t)}},(ABW=ABW||{}).INSCPHASE1={init:function(e){this.$root=$(e),this.initVars(),this.initEvents()},initVars(){this.$form=this.$root.find("form.insc-form"),this.$submitcontainer=this.$root.find(".submit-container"),this.$upload=this.$root.find(".insc-upload"),this.$zone=this.$upload.find(".zone"),this.$input=this.$upload.find('input[type="file"][name="fotos[]"]'),this.$list=this.$upload.find(".file-list"),this.$list.length||(this.$list=$('<div class="file-list" />').appendTo(this.$upload)),this.$nome=this.$form.find('[name="nome"]'),this.$apelido=this.$form.find('[name="apelido"]'),this.$email=this.$form.find('[name="email"]'),this.$tel=this.$form.find('[name="telefone"]'),this.$nasc=this.$form.find('[name="nascimento"]'),this.$cidade=this.$form.find('[name="cidade"]'),this.$grupo=this.$form.find('[name="grupo"]'),this.$estilo=this.$form.find('[name="estilo"]'),this.$insta=this.$form.find('[name="instagram"]'),this.$deezer=this.$form.find('[name="deezer"]'),this.$desc=this.$form.find('[name="description_groupe"]'),this.$consent=this.$form.find('[name="consent"]'),this.maxFiles=5,this.minFiles=1,this.maxSize=10485760,this.accept=["image/jpeg","image/png"],this.allowSend=!0,this.files=[],this.dtSupported=!1;try{this.dt=new DataTransfer,this.dtSupported=!!this.dt&&!!this.dt.items}catch(e){this.dtSupported=!1}},initEvents(){const e=this;$(".js-insc-open").on("click",this.openModal.bind(this)),$(".js-insc-close").on("click",this.closeModal.bind(this)),this.$zone.on("click",()=>this.$input.trigger("click")),this.$zone.on("dragenter dragover",e=>{e.preventDefault(),e.stopPropagation(),this.$zone.addClass("dragover")}).on("dragleave dragend",e=>{e.preventDefault(),e.stopPropagation(),this.$zone.removeClass("dragover")}).on("drop",e=>{e.preventDefault(),e.stopPropagation(),this.$zone.removeClass("dragover"),this.addFiles(e.originalEvent.dataTransfer.files),this.updatePhotoValidity()}),this.$input.on("change",e=>{this.addFiles(e.target.files),e.target.value="",this.updatePhotoValidity()}),this.$list.on("click",".remove",function(){const t=Number($(this).closest(".file").data("idx"));e.removeAt(t),e.updatePhotoValidity()}),this.$form.on("submit",t=>{if(t.preventDefault(),!e.allowSend)return;if(e.allowSend=!1,!this.validateAll())return void(e.allowSend=!0);e.$submitcontainer.addClass("sending");const i=new FormData(this.$form[0]);i.delete("fotos[]"),this.files.forEach(e=>i.append("fotos[]",e,e.name)),fetch(this.$form.attr("action"),{method:"POST",body:i,credentials:"same-origin"}).then(e=>e.json()).then(t=>{if(t&&t.success)e.$root.addClass("success");else{const i=t&&t.data&&t.data.message?t.data.message:"Erreur lors de l'envoi.";e.$submitcontainer.removeClass("sending"),alert(i)}e.allowSend=!0}).catch(()=>{e.allowSend=!0,alert("Erreur lors de l'envoi.")})});const t=(e,t)=>this.$form.on("blur change",e,()=>this.setFieldValidity(t()));t('[name="nome"]',()=>this.validateNome()),t('[name="apelido"]',()=>this.validateApelido()),t('[name="email"]',()=>this.validateEmail()),t('[name="telefone"]',()=>this.validateTel()),t('[name="nascimento"]',()=>this.validateNasc()),t('[name="cidade"]',()=>this.validateCidade()),t('[name="grupo"]',()=>this.validateGrupo()),t('[name="estilo"]',()=>this.validateEstilo()),t('[name="instagram"]',()=>this.validateInsta()),t('[name="deezer"]',()=>this.validateDeezer()),t('[name="description_groupe"]',()=>this.validateDesc()),t('[name="consent"]',()=>this.validateConsent())},openModal:function(e){e&&e.preventDefault&&e.preventDefault();var t=window.ABW&&ABW.smoother?ABW.smoother:null;this.scrollY=t?t.scrollTop():window.pageYOffset||document.documentElement.scrollTop||0,t&&t.paused(!0);var i=document.getElementById("smooth-content");i&&i.classList.add("lock-scroll"),document.documentElement.classList.add("modal-open");var s=document.querySelector(".insc-overlay");s&&(s.classList.add("open"),s.scrollTop=0),"undefined"!=typeof _paq&&_paq.push(["trackEvent","Modal","Ouverture","Inscription"])},closeModal:function(){if(this.allowSend){var e=document.querySelector(".insc-overlay");e&&e.classList.remove("open"),document.documentElement.classList.remove("modal-open");var t=window.ABW&&ABW.smoother?ABW.smoother:null;if(t){var i=document.getElementById("smooth-content");i&&i.classList.remove("lock-scroll"),t.paused(!1),t.scrollTo(this.scrollY||0,!1)}else window.scrollTo(0,this.scrollY||0)}},addFiles(e){const t=Array.from(e);for(const e of t){if(this.files.length>=this.maxFiles){this.flash("Maximum "+this.maxFiles+" photos.");break}this.accept.includes(e.type)?e.size>this.maxSize?this.flash("Chaque fichier doit être inférieur à 10 Mo."):this.isDuplicate(e)?this.flash("Fichier déjà ajouté ignoré."):this.files.push(e):this.flash("Seulement JPG/PNG.")}this.syncInput(),this.renderList()},removeAt(e){e<0||e>=this.files.length||(this.files.splice(e,1),this.syncInput(),this.renderList())},isDuplicate(e){return this.files.some(t=>t.name===e.name&&t.size===e.size&&t.lastModified===e.lastModified)},syncInput(){this.dtSupported&&(this.dt=new DataTransfer,this.files.forEach(e=>this.dt.items.add(e)),this.$input[0].files=this.dt.files)},renderList(){this.$list.empty(),this.files.length?(this.$list.addClass("has-items"),this.files.forEach((e,t)=>{const i=URL.createObjectURL(e),s=$(`<div class="file" data-idx="${t}">\n              <div class="thumb"><img alt=""></div>\n              <div class="meta"><span class="name"></span><span class="size"></span></div>\n              <button type="button" class="remove" aria-label="Supprimer">×</button>\n            </div>`);s.find(".name").text(e.name),s.find(".size").text(this.humanSize(e.size)),s.find("img").attr("src",i).on("load",()=>URL.revokeObjectURL(i)),this.$list.append(s)})):this.$list.removeClass("has-items")},humanSize(e){if(e<1024)return e+" o";const t=e/1024;return t<1024?Math.round(t)+" Ko":(t/1024).toFixed(2)+" Mo"},flash(e){if(!e)return;const t=$('<div class="dz-msg" />').text(e).appendTo(this.$zone);this.$zone.addClass("shake"),setTimeout(()=>{t.fadeOut(150,()=>t.remove()),this.$zone.removeClass("shake")},1300)},validateAll(){const e=[this.validateNome(),this.validateApelido(),this.validateEmail(),this.validateTel(),this.validateNasc(),this.validateCidade(),this.validateGrupo(),this.validateEstilo(),this.validateInsta(),this.validateDeezer(),this.validateDesc(),this.validateConsent(),this.validatePhotos()].find(e=>!e.valid);return!e||(this.setFieldValidity(e),e.$el.trigger("focus"),!1)},validateNome(){return this._required(this.$nome,"Indique ton nom.")},validateApelido(){return this._required(this.$apelido,"Indique ton prénom.")},validateEmail(){const e=(this.$email.val()||"").trim(),t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);return{$el:this.$email,valid:t,msg:t?"":"Email invalide."}},validateTel(){const e=(this.$tel.val()||"").trim(),t=/^0[1-9](?:[ .-]?\d{2}){4}$/.test(e);return{$el:this.$tel,valid:t,msg:t?"":"Numéro de téléphone invalide."}},validateNasc(){const e=(this.$nasc.val()||"").trim();let t=!!e,i="Sélectionne ta date de naissance.";if(t){const s=new Date(e),o=this.calcAge(s);i=(t=!isNaN(s.getTime())&&o>=18&&o<=120)?"":"Âge minimum 18 ans."}return{$el:this.$nasc,valid:t,msg:i}},validateCidade(){const e=(this.$cidade.val()||"").trim(),t=/^[0-9]{5}$/.test(e);return{$el:this.$cidade,valid:t,msg:t?"":"Indique un code postal valide à 5 chiffres."}},validateGrupo(){return this._required(this.$grupo,"Indique le nom de ton groupe.")},validateEstilo(){return this._required(this.$estilo,"Indique ton style musical.")},validateInsta(){const e=(this.$insta.val()||"").trim(),t=/^@?[\w\.]{1,30}$/.test(e);return{$el:this.$insta,valid:t,msg:t?"":"Handle Instagram invalide."}},validateDeezer(){const e=(this.$deezer.val()||"").trim();try{return new URL(e),{$el:this.$deezer,valid:!0,msg:""}}catch(e){return{$el:this.$deezer,valid:!1,msg:"Lien Deezer invalide."}}},validateDesc(){return this._required(this.$desc,"Décris ton groupe.")},validateConsent(){const e=this.$consent.is(":checked");return{$el:this.$consent,valid:e,msg:e?"":"Tu dois accepter le règlement."}},validatePhotos(){const e=this.files.length,t=e>=this.minFiles&&e<=this.maxFiles,i=e?e>this.maxFiles?"Maximum "+this.maxFiles+" photos.":"":"Ajoute au moins une photo.";return{$el:this.$zone,valid:t,msg:i}},updatePhotoValidity(){const e=this.validatePhotos();this.setFieldValidity(e)},_required(e,t){const i=(e.val()||"").trim();return{$el:e,valid:!!i,msg:i?"":t}},calcAge(e){const t=new Date;let i=t.getFullYear()-e.getFullYear();const s=t.getMonth()-e.getMonth();return(s<0||0===s&&t.getDate()<e.getDate())&&i--,i},setFieldValidity(e){const t=e.$el;let i=t.closest("label, .consent, .zone, .insc-desc");i.length||(i=t.parent());let s=i.find(".field-error");return s.length||(s=$('<span class="field-error" aria-live="polite"></span>').appendTo(i)),e.valid?(t.attr("aria-invalid","false"),i.removeClass("has-error"),s.text("")):(t.attr("aria-invalid","true"),i.addClass("has-error"),s.text(e.msg)),e.valid}},(ABW=ABW||{}).PHASE1={init:function(e){this.el=$(e),this.initCountdown(),this.initEvents()},initEvents(){},gotoArea(e){e.preventDefault();const t=$(e.currentTarget).attr("href"),i=$(t),s=i[0].getBoundingClientRect().top+window.scrollY-50;i&&(e.preventDefault(),ABW.smoother.scrollTo(s,!0))},initCountdown(){const e=this.el.find(".countdown"),t=e.data("date").replace(/(\d{2})\/(\d{2})\/(\d{4}) (.*)/,"$3-$2-$1T$4");function i(){const i=(new Date).getTime(),s=new Date(t).getTime()-i;if(s<=0)return void e.text("00j 00h 00m");const o=Math.floor(s/864e5),n=Math.floor(s/36e5%24),a=Math.floor(s/6e4%60);e.text(`${o}j ${n.toString().padStart(2,"0")}h ${a.toString().padStart(2,"0")}m`)}i(),setInterval(i,6e4)}},(ABW=ABW||{}).PHASE2={init:function(e){this.el=$(e),this.popup=$("#popup-vote"),this.initEvents()},initEvents(){const e=this;this.el.find(".js-open-vote").on("click",this.openPopup.bind(this)),this.el.find(".copy-link").on("click",function(t){e.copyShareLink(t)}),this.popup.find(".sendVote").on("click",this.submitVote.bind(this)),this.popup.find(".check").on("click",this.checkBoces.bind(this)),this.popup.find(".email-input").on("focus",this.clearError.bind(this)),this.popup.find(".bg, .close, .js-close").on("click",this.closePopup.bind(this))},openPopup(e){e.preventDefault(),this.popup.addClass("open")},closePopup(e){e.preventDefault(),this.popup.removeClass("open")},copyShareLink(e){e.preventDefault();const t=window.location.href;if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(t).then(()=>{alert("Lien copié !")}).catch(()=>{alert("Impossible de copier le lien.")});else{const e=document.createElement("input");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),alert("Lien copié !")}},checkBoces(e){console.log("checkBoces"),$(e.currentTarget).toggleClass("checked"),this.popup.find(".error").empty().hide()},clearError(){this.popup.find(".error").empty().hide()},submitVote(e){e.preventDefault();const t=this.popup.find("#vote-form"),i=this.popup.find(".error"),s=t.find(".email-input").val().trim(),o=(this.popup.find(".js-terms"),this.popup.find(".js-reg")),n=this.popup.find(".inside"),a=this.popup.find(".success");i.empty().hide();const l=[];return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)?o.hasClass("checked")?void $.post(appapi.ajaxurl,t.serialize(),function(e){e.success?(n.removeClass("show"),a.addClass("show")):i.addClass("is-error").html(e.data.message).show()}):(l.push("Merci d’accepter le réglement du concours et de certifier avoir plus de 18 ans."),void i.html(l).show()):(l.push("Merci d'entrer une adresse email valide."),void i.html(l).show())}};